# Business Bot (BuisBot)

Это пользовательский бот Telegram (userbot), созданный для автоматизации ответов, анализа сообщений и медиафайлов с использованием Google Gemini AI. Бот работает под вашим аккаунтом Telegram.

## Функционал

* **Хранение истории сообщений:** Бот сохраняет все текстовые сообщения и подписи к медиафайлам в локальную базу данных SQLite (`bot_database.db` по умолчанию).
* **Взаимодействие с Gemini AI:**
  * При упоминании "Гемини," в начале сообщения, бот использует историю чата и ваш запрос для генерации ответа с помощью Gemini Flash.
  * Команда `!думай` в запросе к Gemini активирует более "вдумчивую" модель (`gemini-2.0-flash-thinking-exp-01-21`).
* **Анализ медиафайлов:** Команда `!media <промпт>` (в ответ на сообщение с медиа) позволяет проанализировать фото, видео, голосовое сообщение, GIF или видео-кружок с помощью Gemini.
* **Управление чатами:**
  * `!enable`: Добавляет текущий чат в белый список для обработки сообщений ботом.
  * `!disable`: Удаляет текущий чат из белого списка.
* **Отметка важных сообщений:** Команда `!Гемини <сообщение>` помечает ваше сообщение как важное (доступно только владельцу бота). Важные сообщения всегда включаются в контекст для Gemini.
* **Отладка:** Команда `!debug` выводит последние 10 сообщений из истории чата в формате, используемом для Gemini.
* **Тест:** Команда `!test` проверяет, что бот активен и отвечает.

## Установка и запуск

Проект использует Docker и Docker Compose для легкого развертывания.

1. **Клонируйте репозиторий:**

    ```bash
    git clone <URL репозитория>
    cd buisbot
    ```

2. **Создайте файл `.env`:**
    Скопируйте `.env.example` (если он есть) или создайте файл `.env` вручную со следующим содержимым:

    ```dotenv
    API_ID=<Ваш Telegram API ID>
    API_HASH=<Ваш Telegram API HASH>
    SESSION_NAME=business_bot # Имя файла сессии
    DATABASE_PATH=bot_database.db # Путь к файлу базы данных
    GEMINI_API_KEY=<Ваш Google Gemini API Key>
    ```

    * Получить `API_ID` и `API_HASH` можно на [my.telegram.org](https://my.telegram.org/).
    * Получить `GEMINI_API_KEY` можно в [Google AI Studio](https://aistudio.google.com/app/apikey).
3. **Запустите бота:**

    ```bash
    docker compose up -d --build
    ```

    При первом запуске вам нужно будет авторизоваться в Telegram, введя номер телефона и код подтверждения в консоли Docker (`docker logs -f <имя_контейнера>`). Сессия сохранится в файле `business_bot.session` (или с именем, указанным в `SESSION_NAME`).

## Запуск второго экземпляра бота

В `docker-compose.yml` настроен второй сервис `bot_2`, который использует отдельный профиль `bot2`, отдельный файл окружения `.env.bot2` и отдельный том `korbot` для данных (включая файл сессии).

1. **Создайте файл `.env.bot2`:** Аналогично `.env`, но с данными для второго аккаунта Telegram и, возможно, другим `SESSION_NAME` и `DATABASE_PATH`, если нужно разделить базы данных.

    ```dotenv
    # .env.bot2
    API_ID=<API ID второго аккаунта>
    API_HASH=<API HASH второго аккаунта>
    SESSION_NAME=korbot_session # Например
    DATABASE_PATH=korbot_database.db # Например
    GEMINI_API_KEY=<Ваш Google Gemini API Key>
    ```

2. **Запустите второго бота:**

    ```bash
    docker compose up --profile bot2 -d --build
    ```

    Также потребуется авторизация при первом запуске для этого экземпляра.

## Управление ботом

* **Включение/выключение чатов:** Используйте команды `!enable` и `!disable` в нужных чатах. По умолчанию бот игнорирует все чаты, кроме ЛС с самим собой.
* **Взаимодействие с Gemini:** Пишите "Гемини, <ваш запрос>" или отвечайте на сообщение с медиа командой `!media <ваш промпт>`.
* **Владелец бота:** Пользователь с ID `782491733` (задан в `config.py`) имеет доступ к командам `!Гемини` и `!debug`.

## Зависимости

Основные зависимости указаны в `pyproject.toml`:

* `pyrogram`: Асинхронная библиотека для работы с Telegram API.
* `python-dotenv`: Загрузка переменных окружения из `.env` файла.
* `google-genai`: Клиент для Google Gemini API.
* `tgcrypto-pyrofork`: Библиотека для шифрования Pyrogram.
